<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CricHD Proxy Player - Video.js v8 + hls.js</title>

<!-- Video.js v8 CSS -->
<link href="https://vjs.zencdn.net/8.23.4/video-js.css" rel="stylesheet" />

<style>
body { margin:0; font-family:Arial; background:#111; color:#fff; display:flex; }
#list { width:300px; height:100vh; overflow-y:auto; background:#000; }
#list div { padding:10px; border-bottom:1px solid #222; cursor:pointer; display:flex; align-items:center; gap:10px; }
#list div:hover { background:#222; }
#list img { width:40px; height:40px; border-radius:6px; }
#player-container { flex:1; display:flex; justify-content:center; align-items:center; background:#000; height:100vh; }
.video-js { width:100%; height:100%; max-height:100vh; }
</style>
</head>

<body>

<div id="list">Loading channels...</div>
<div id="player-container">
    <video id="video-player" class="video-js vjs-default-skin" controls></video>
</div>

<!-- Video.js v8 JS -->
<script src="https://vjs.zencdn.net/8.23.4/video.min.js"></script>
<!-- hls.js -->
<script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.0/dist/hls.min.js"></script>

<script>
const API_URL = "https://raw.githubusercontent.com/abusaeeidx/CricHd-playlists-Auto-Update-permanent/main/api.json";
const PROXY = "http://localhost:8000/stream"; // Python proxy server

// Initialize Video.js v8 player
const player = videojs('video-player', { autoplay: false, controls: true });

async function loadChannels() {
    const res = await fetch(API_URL);
    const channels = await res.json();

    const list = document.getElementById('list');
    list.innerHTML = '';

    channels.forEach(ch => {
        const div = document.createElement('div');
        div.innerHTML = `<img src="${ch.logo}"><span>${ch.name}</span>`;
        div.onclick = () => playChannel(ch);
        list.appendChild(div);
    });
}

function playChannel(ch) {
    const proxy_url = `${PROXY}?url=${encodeURIComponent(ch.link)}&referer=${encodeURIComponent(ch.referer)}&origin=${encodeURIComponent(ch.origin)}`;

    // Stop previous playback
    player.pause();
    player.src({ src: '', type: '' });

    if (Hls.isSupported()) {
        const hls = new Hls();
        hls.loadSource(proxy_url);
        hls.attachMedia(player.tech().el());
        hls.on(Hls.Events.MANIFEST_PARSED, function() {
            player.play();
        });
    } else if (player.tech().el().canPlayType('application/vnd.apple.mpegurl')) {
        player.src({ src: proxy_url, type: 'application/vnd.apple.mpegurl' });
        player.play();
    }

    player.poster(ch.logo);
}

loadChannels();
</script>
</body>
</html>
